name: Static Site CI/CD to GitHub Pages

# 1. Configuration: Set the directory where your package.json, code, etc. lives
# ðŸ’¡ IMPORTANT: CHANGE THIS TO YOUR ACTUAL SUBFOLDER NAME (e.g., 'frontend', 'client')
env:
  PROJECT_ROOT: YOUR_PROJECT_FOLDER 
  BUILD_OUTPUT_DIR: dist
  
# 2. Trigger: Run on pushes to the 'main' branch and manually
on:
  push:
    branches:
      - main
  workflow_dispatch:

# --- CI Job: Linting, Testing, and Building (Verification Stage) ---
jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. FIX: Install dependencies 
      # The 'working-directory' tells the runner where the package.json is.
      - name: Install dependencies
        run: npm install
        working-directory: ${{ env.PROJECT_ROOT }}

      # 4. FIX: Run Linting (Optional)
      - name: Run Linting
        run: npm run lint || true 
        working-directory: ${{ env.PROJECT_ROOT }}

      # 5. FIX: Run Tests (Optional)
      - name: Run Tests
        run: npm test || true 
        working-directory: ${{ env.PROJECT_ROOT }}

      # 6. FIX: Build Step (If you use a bundler)
      - name: Build project (if needed)
        run: npm run build
        working-directory: ${{ env.PROJECT_ROOT }}
        
# ------------------------------------------------------------------
# --- CD Job: Deployment to GitHub Pages ---
  deploy:
    # 7. Dependency Connection: Only runs if the 'ci' job succeeds
    needs: ci
    runs-on: ubuntu-latest

    permissions:
      pages: write
      id-token: write

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Pages
        uses: actions/configure-pages@v4

      # 8. Upload Artifact
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # ðŸ”‘ CRITICAL PATH: The path must point to the folder *inside* the project folder 
          # that contains the final static files (e.g., frontend/dist)
          path: ${{ env.PROJECT_ROOT }}/${{ env.BUILD_OUTPUT_DIR }} 

      # 9. Deploy to GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
